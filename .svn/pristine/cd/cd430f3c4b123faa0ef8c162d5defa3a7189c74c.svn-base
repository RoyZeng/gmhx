<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gome.gmhx.dao.sysconfig.HxMenuDao">
	<resultMap id="BaseResultMap" type="com.gome.gmhx.entity.HxMenu" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Jul 18 13:49:22 CST 2014.
    -->
    <id column="menu_id" property="menuId" jdbcType="VARCHAR" />
    <result column="parent_id" property="parentId" jdbcType="VARCHAR" />
    <result column="menu_name" property="menuName" jdbcType="VARCHAR" />
    <result column="url" property="url" jdbcType="VARCHAR" />
    <result column="icon_url" property="iconUrl" jdbcType="VARCHAR" />
    <result column="sort" property="sort" jdbcType="VARCHAR" />
    <result column="menu_desc" property="menuDesc" jdbcType="VARCHAR" />
    <result column="parent_name" property="parentName" jdbcType="VARCHAR" />
    <result column="is_leaf_node" property="isLeafNode" jdbcType="VARCHAR" />
  	</resultMap>
  	<sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Jul 18 13:49:22 CST 2014.
    -->
    	menu_id, parent_id, menu_name, url, icon_url, sort, menu_desc,is_leaf_node
   </sql>
	<select id="getMenuTree" resultMap="BaseResultMap">
		SELECT * FROM hx_menu where is_leaf_node='0' ORDER BY SORT ASC
	</select>
	<select id="getMenuPageList" parameterType="com.gome.common.page.Page" resultMap="BaseResultMap">
   		select	t.menu_id, t.parent_id, t.menu_name, t.url, t.icon_url, t.sort, t.menu_desc,t.is_leaf_node,hm.menu_name as parent_name
    	from hx_menu t left  join hx_menu hm on t.parent_id = hm.menu_id where 1=1
		<if test="param.menuName != null and param.menuName !='' ">
		   and t.menu_name like CONCAT('%',#{param.menuName},'%')
		</if>
		<if test="param.parentName != null and param.parentName !='' ">
		   and hm.menu_name like CONCAT('%',#{param.parentName},'%')
		</if>
  </select>
  
  <select id="getMenuById" resultMap="BaseResultMap" parameterType="java.lang.String" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Jul 18 13:49:22 CST 2014.
    -->
    select 
   	t.menu_id, t.parent_id, t.menu_name, t.url, t.icon_url, t.sort, t.menu_desc,t.is_leaf_node,hm.menu_name as parent_name
    from hx_menu t left  join hx_menu hm on t.parent_id = hm.menu_id 
    where t.menu_id = #{menuId,jdbcType=VARCHAR}
  </select>
  
  
  <insert id="addMenu" parameterType="com.gome.gmhx.entity.HxMenu" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Jul 18 13:49:22 CST 2014.
    -->
    insert into hx_menu (menu_id, parent_id, menu_name, 
      url, icon_url, sort, 
      menu_desc,is_leaf_node)
    values (#{menuId,jdbcType=VARCHAR}, #{parentId,jdbcType=VARCHAR}, #{menuName,jdbcType=VARCHAR}, 
      #{url,jdbcType=VARCHAR}, #{iconUrl,jdbcType=VARCHAR}, #{sort,jdbcType=VARCHAR}, 
      #{menuDesc,jdbcType=VARCHAR},#{isLeafNode,jdbcType=VARCHAR})
  </insert>
 
  <update id="updateMenu" parameterType="com.gome.gmhx.entity.HxMenu" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Jul 18 13:49:22 CST 2014.
    -->
    update hx_menu
    set parent_id = #{parentId,jdbcType=VARCHAR},
      menu_name = #{menuName,jdbcType=VARCHAR},
      url = #{url,jdbcType=VARCHAR},
      icon_url = #{iconUrl,jdbcType=VARCHAR},
      sort = #{sort,jdbcType=VARCHAR},
      menu_desc = #{menuDesc,jdbcType=VARCHAR},
      is_leaf_node = #{isLeafNode,jdbcType=VARCHAR}
    where menu_id = #{menuId,jdbcType=VARCHAR}
  </update>
  
  <select id="getUserMenus" parameterType="com.gome.gmhx.entity.HxUserPosition" resultMap="BaseResultMap">
	select m.* from hx_user_position up left join hx_position p on up.position_id = p.position_code 
	left join hx_position_role pr on pr.position_id = p.position_code 
	left join hx_role_menu rm on pr.role_id = rm.role_id
	left join hx_menu m on rm.menu_id = m.menu_id
    where up.user_login_name = #{userLoginName,jdbcType=VARCHAR} and up.from_type = #{fromType,jdbcType=VARCHAR}
 </select>
 
 <select id="getAllMenuTree" resultMap="BaseResultMap">
	SELECT * FROM hx_menu ORDER BY SORT ASC
 </select>
 
 <select id="getPositionMenuTree" resultMap="BaseResultMap" parameterType="java.lang.String">
	select t.* from hx_menu t where t.is_leaf_node='0' and t.menu_id 
	in( select hpm.menu_id from hx_position_menu hpm where hpm.position_id=#{sysPositionId,jdbcType=VARCHAR})
	order by sort asc
 </select>
 
 <select id="getPositionRoleMenuTree" resultMap="BaseResultMap" parameterType="java.lang.String">
	select t.* from hx_menu t where t.is_leaf_node='0' and t.menu_id 
	in( select hrm.menu_id from hx_role_menu hrm 
	left join hx_position_role hpr on hrm.role_id = hpr.role_id
	left join (select hp.position_code from hx_position hp union select distinct(emp.positioncode) as position_code from emp_empposition emp ) p on hpr.position_id = p.position_code where p.position_code=#{sysPositionId,jdbcType=VARCHAR})
	order by sort asc
 </select>
</mapper>