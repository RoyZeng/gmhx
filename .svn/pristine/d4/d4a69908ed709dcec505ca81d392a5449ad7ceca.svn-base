<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.gome.gmhx.dao.sysconfig.HxOrganizationDao" >
  <resultMap id="BaseResultMap" type="com.gome.gmhx.entity.HxOrganization" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jul 14 17:03:37 CST 2014.
    -->
    <id column="org_code" property="orgCode" jdbcType="VARCHAR" />
    <result column="org_name" property="orgName" jdbcType="VARCHAR" />
    <result column="org_city" property="orgCity" jdbcType="VARCHAR" />
    <result column="org_level" property="orgLevel" jdbcType="VARCHAR" />
    <result column="org_layer" property="orgLayer" jdbcType="VARCHAR" />
    <result column="org_parent_id" property="orgParentId" jdbcType="VARCHAR" />
    <result column="org_type" property="orgType" jdbcType="VARCHAR" />
    <result column="org_is_leaf" property="orgIsLeaf" jdbcType="BIT" />
    <result column="org_manager" property="orgManager" jdbcType="VARCHAR" />
    <result column="org_manager_phone" property="orgManagerPhone" jdbcType="VARCHAR" />
    <result column="org_reference" property="orgReference" jdbcType="VARCHAR" />
    <result column="org_address" property="orgAddress" jdbcType="VARCHAR" />
    <result column="org_post_code" property="orgPostCode" jdbcType="VARCHAR" />
    <result column="org_email_address" property="orgEmailAddress" jdbcType="VARCHAR" />
    <result column="org_bill_address" property="orgBillAddress" jdbcType="VARCHAR" />
    <result column="org_telephone" property="orgTelephone" jdbcType="VARCHAR" />
    <result column="org_fax" property="orgFax" jdbcType="VARCHAR" />
    <result column="org_note" property="orgNote" jdbcType="VARCHAR" />
    <result column="org_create_id" property="orgCreateId" jdbcType="VARCHAR" />
    <result column="org_create_date" property="orgCreateDate" jdbcType="TIMESTAMP" />
    <result column="org_update_id" property="orgUpdateId" jdbcType="VARCHAR" />
    <result column="org_update_date" property="orgUpdateDate" jdbcType="TIMESTAMP" />
    <result column="org_active" property="orgActive" jdbcType="BIT" />
    <result column="org_dealer_id" property="orgDealerId" jdbcType="VARCHAR" />
    <result column="code_value" property="codeValue" jdbcType="VARCHAR" />
    <result column="org_active_name" property="orgActiveName" jdbcType="VARCHAR" />
    <result column="org_parent_name" property="orgParentName" jdbcType="VARCHAR" />
    <result column="from_type" property="fromType" jdbcType="VARCHAR" />
    <result column="org_source" property="orgSource" jdbcType="VARCHAR" />
    <result column="org_approval" property="orgApproval" jdbcType="VARCHAR" />
    <result column="org_approval_name" property="orgApprovalName" jdbcType="VARCHAR" />
    <result column="is_fitting_stock" property="isFittingStock" jdbcType="VARCHAR" />
    <result column="fitting_pid" property="fittingPid" jdbcType="VARCHAR" />
    <result column="is_fitting_stock_name" property="isFittingStockName" jdbcType="VARCHAR" />
    <result column="fitting_pid_name" property="fittingPidName" jdbcType="VARCHAR" />
    <result column="part_id" property="partId" jdbcType="VARCHAR" />
  </resultMap>
 
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jul 14 17:03:37 CST 2014.
    -->
    org_name, org_code, org_city, org_level, org_layer, org_parent_id, org_type, 
    org_is_leaf, org_manager, org_manager_phone, org_reference, org_address, org_post_code, 
    org_email_address, org_bill_address, org_telephone, org_fax, org_note, org_create_id, 
    org_create_date, org_update_id, org_update_date, org_active, org_dealer_id,org_source,org_approval,is_fitting_stock,fitting_pid
  </sql>
  
  <select id="getOrganizationPageList" parameterType="com.gome.common.page.Page" resultMap="BaseResultMap">
	select t.* from (select v.id as org_code,v.name as org_name,o.org_type,v.pid as org_parent_id,o.org_address,o.org_post_code,
	o.org_telephone,o.org_manager,o.org_manager_phone,o.org_fax,c.code_value,v.pname as org_parent_name,v.interface as fromType,if(o.org_active = 0, '停用', '正常使用') as org_active_name
	from hx_organization_unload v left join hx_organization o on v.id = o.org_code left join hx_code_setting c on o.org_type = c.code_key and c.code_id = 'jglx') t where 1=1		
		<if test="param.orgName != null and param.orgName != '' ">
		   and t.org_name like CONCAT('%',#{param.orgName},'%')
		</if>
		<if test="param.orgCode != null and param.orgCode != ''">
		   and t.org_code like CONCAT('%',#{param.orgCode},'%')
		</if>
		<if test="param.orgParentId != null and param.orgParentId != ''">
		   and t.org_parent_id like CONCAT('%',#{param.orgParentId},'%')
		</if>
		<if test="param.orgType != null and param.orgType != ''">
		   and t.org_type like CONCAT('%',#{param.orgType},'%')
		</if>
		<if test="param.orgAddress != null and param.orgAddress != ''">
		   and t.org_address like CONCAT('%',#{param.orgAddress},'%')
		</if>
		<if test="param.orgPostCode != null and param.orgPostCode != ''">
		   and t.org_post_code like CONCAT('%',#{param.orgPostCode},'%')
		</if>
		<if test="param.orgTelephone != null and param.orgTelephone != ''">
		   and t.org_telephone like CONCAT('%',#{param.orgTelephone},'%')
		</if>
		<if test="param.orgManager != null and param.orgManager != ''">
		   and t.org_manager like CONCAT('%',#{param.orgManager},'%')
		</if>
		<if test="param.orgManagerPhone != null and param.orgManagerPhone != ''">
		   and t.org_manager_phone like CONCAT('%',#{param.orgManagerPhone},'%')
		</if>
		<if test="param.orgFax != null and param.orgFax != ''">
		   and t.org_fax like CONCAT('%',#{param.orgFax},'%')
		</if>
		<if test="param.orgActive != null and param.orgActive != ''">
		   and t.org_active like CONCAT('%',#{param.orgActive},'%')
		</if>
  </select>
  
   <select id="getOrganizationExport" parameterType="com.gome.gmhx.entity.HxOrganization" resultType="hashmap">
	select t.org_name as orgName,t.org_code as orgCode,
	(case when (t.org_parent_name is null) then ''  else t.org_parent_name end) as orgParentName,
	(case when (t.code_value is null) then ''  else t.code_value end) as codeValue,
	(case when (t.org_address is null) then ''  else t.org_address end) as orgAddress,
	(case when (t.org_post_code is null) then ''  else t.org_post_code end) as orgPostCode,
	(case when (t.org_telephone is null) then ''  else t.org_telephone end) as orgTelephone,
	(case when (t.org_manager is null) then ''  else t.org_manager end) as orgManager,
	(case when (t.org_manager_phone is null) then ''  else t.org_manager_phone end) as orgManagerPhone,
	(case when (t.org_fax is null) then ''  else t.org_fax end) as orgFax,
	t.fromType,t.org_active_name as orgActiveName
	from (select v.id as org_code,v.name as org_name,o.org_type,v.pid as org_parent_id,o.org_address,o.org_post_code,
	o.org_telephone,o.org_manager,o.org_manager_phone,o.org_fax,c.code_value,v.pname as org_parent_name,v.interface as fromType,if(o.org_active = 0, '停用', '正常使用') as org_active_name
	from hx_organization_unload v left join hx_organization o on v.id = o.org_code left join hx_code_setting c on o.org_type = c.code_key and c.code_id = 'jglx') t where 1=1		
		<if test="orgName != null and orgName != '' ">
		   and org_name like CONCAT('%',#{orgName},'%')
		</if>
		<if test="orgCode != null and orgCode != ''">
		   and org_code like CONCAT('%',#{orgCode},'%')
		</if>
		<if test="orgParentId != null and orgParentId != ''">
		   and org_parent_id like CONCAT('%',#{orgParentId},'%')
		</if>
		<if test="orgType != null and orgType != ''">
		   and org_type like CONCAT('%',#{orgType},'%')
		</if>
		<if test="orgAddress != null and orgAddress != ''">
		   and org_address like CONCAT('%',#{orgAddress},'%')
		</if>
		<if test="orgPostCode != null and orgPostCode != ''">
		   and org_post_code like CONCAT('%',#{orgPostCode},'%')
		</if>
		<if test="orgTelephone != null and orgTelephone != ''">
		   and org_telephone like CONCAT('%',#{orgTelephone},'%')
		</if>
		<if test="orgManager != null and orgManager != ''">
		   and org_manager like CONCAT('%',#{orgManager},'%')
		</if>
		<if test="orgManagerPhone != null and orgManagerPhone != ''">
		   and org_manager_phone like CONCAT('%',#{orgManagerPhone},'%')
		</if>
		<if test="orgFax != null and orgFax != ''">
		   and org_fax like CONCAT('%',#{orgFax},'%')
		</if>
		<if test="orgActive != null and orgActive != ''">
		   and org_active like CONCAT('%',#{orgActive},'%')
		</if>
  </select>
  
  <select id="getOrganizationById" resultMap="BaseResultMap" parameterType="java.lang.String" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jul 14 17:03:37 CST 2014.
    -->
    select v.id as org_code,v.name as org_name,v.pid as org_parent_id,c.code_value,c1.code_value as orgApprovalName,v1.name as org_parent_name,v.interface as fromType,
	c2.code_value as is_fitting_stock_name,v2.`name` as fitting_pid_name,o.*,
    if(o.org_active = 0, '停用', '正常使用') as org_active_name 
	from hx_organization_unload v left join hx_organization o on v.id = o.org_code
    left join hx_code_setting c on o.org_type = c.code_key and c.code_id = 'jglx' 
    left join hx_code_setting c1 on o.org_approval = c1.code_key and c1.code_id = 'sf' 
    left join hx_organization_unload v1 on v.pid = v1.id
	left join hx_code_setting c2 on o.is_fitting_stock = c2.code_key and c2.code_id = 'sf' 
	left join hx_organization_unload v2 on o.fitting_pid = v2.id
    where v.id = #{orgCode,jdbcType=VARCHAR}
  </select>
  
  <select id="getOrganizationByPeripheralId" resultMap="BaseResultMap" parameterType="java.lang.String" >
   select 
	vo.id as org_code,vo.`name` as org_name,vo.pid as org_parent_id,'' as org_address,'' as org_post_code,'' as org_telephone,'' as org_manager,
	'' as org_manager_phone,'' as org_fax,'' as code_value,vo1.`name` as org_parent_name,'2' as from_type,'' as org_active_name   from hx_organization_unload vo left join hx_organization_unload vo1 on vo.pid=vo1.id
	where 1=1 
    and vo.id = #{orgCode,jdbcType=VARCHAR}
  </select>
  
  <insert id="addOrganization" parameterType="com.gome.gmhx.entity.HxOrganization" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jul 14 17:03:37 CST 2014.
    -->
    insert into hx_organization (org_name, org_code, 
      org_city, org_level, org_layer, 
      org_parent_id, org_type, org_is_leaf, 
      org_manager, org_manager_phone, org_reference, 
      org_address, org_post_code, org_email_address, 
      org_bill_address, org_telephone, org_fax, 
      org_note, org_create_id, org_create_date, 
      org_update_id, org_update_date, org_active, 
      org_dealer_id,org_source,org_approval,is_fitting_stock,fitting_pid)
    values (#{orgName,jdbcType=VARCHAR}, #{orgCode,jdbcType=VARCHAR}, 
      #{orgCity,jdbcType=VARCHAR}, #{orgLevel,jdbcType=VARCHAR}, #{orgLayer,jdbcType=VARCHAR}, 
      #{orgParentId,jdbcType=VARCHAR}, #{orgType,jdbcType=VARCHAR}, #{orgIsLeaf,jdbcType=BIT}, 
      #{orgManager,jdbcType=VARCHAR}, #{orgManagerPhone,jdbcType=VARCHAR}, #{orgReference,jdbcType=VARCHAR}, 
      #{orgAddress,jdbcType=VARCHAR}, #{orgPostCode,jdbcType=VARCHAR}, #{orgEmailAddress,jdbcType=VARCHAR}, 
      #{orgBillAddress,jdbcType=VARCHAR}, #{orgTelephone,jdbcType=VARCHAR}, #{orgFax,jdbcType=VARCHAR}, 
      #{orgNote,jdbcType=VARCHAR}, #{orgCreateId,jdbcType=VARCHAR}, #{orgCreateDate,jdbcType=TIMESTAMP}, 
      #{orgUpdateId,jdbcType=VARCHAR}, #{orgUpdateDate,jdbcType=TIMESTAMP}, #{orgActive,jdbcType=BIT}, 
      #{orgDealerId,jdbcType=VARCHAR},#{orgSource,jdbcType=VARCHAR},#{orgApproval,jdbcType=VARCHAR},
      #{isFittingStock,jdbcType=VARCHAR},#{fittingPid,jdbcType=VARCHAR})
  </insert>
  
  <update id="updateOrganization" parameterType="com.gome.gmhx.entity.HxOrganization" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Jul 14 17:03:37 CST 2014.
    -->
    update hx_organization
    set 
      org_code = #{orgCode,jdbcType=VARCHAR},
      org_name = #{orgName,jdbcType=VARCHAR},
      org_city = #{orgCity,jdbcType=VARCHAR},
      org_level = #{orgLevel,jdbcType=VARCHAR},
      org_layer = #{orgLayer,jdbcType=VARCHAR},
      org_parent_id = #{orgParentId,jdbcType=VARCHAR},
      org_type = #{orgType,jdbcType=VARCHAR},
      org_is_leaf = #{orgIsLeaf,jdbcType=BIT},
      org_manager = #{orgManager,jdbcType=VARCHAR},
      org_manager_phone = #{orgManagerPhone,jdbcType=VARCHAR},
      org_reference = #{orgReference,jdbcType=VARCHAR},
      org_address = #{orgAddress,jdbcType=VARCHAR},
      org_post_code = #{orgPostCode,jdbcType=VARCHAR},
      org_email_address = #{orgEmailAddress,jdbcType=VARCHAR},
      org_bill_address = #{orgBillAddress,jdbcType=VARCHAR},
      org_telephone = #{orgTelephone,jdbcType=VARCHAR},
      org_fax = #{orgFax,jdbcType=VARCHAR},
      org_note = #{orgNote,jdbcType=VARCHAR},
      org_create_id = #{orgCreateId,jdbcType=VARCHAR},
      org_create_date = #{orgCreateDate,jdbcType=TIMESTAMP},
      org_update_id = #{orgUpdateId,jdbcType=VARCHAR},
      org_update_date = #{orgUpdateDate,jdbcType=TIMESTAMP},
      org_active = #{orgActive,jdbcType=BIT},
      org_dealer_id = #{orgDealerId,jdbcType=VARCHAR},
      org_approval = #{orgApproval,jdbcType=VARCHAR},
      is_fitting_stock = #{isFittingStock,jdbcType=VARCHAR},
      fitting_pid = #{fittingPid,jdbcType=VARCHAR}
    where org_code = #{oldOrgCode,jdbcType=VARCHAR}
  </update>
  
  <select id="getOrganizationTree" resultMap="BaseResultMap">
	 select v.id as org_code,v.pid as org_parent_id,v.name as org_name,v.interface as from_type from hx_organization_unload v
  </select>
  
  <select id="getChild" parameterType="string" resultType="string">
	SELECT GROUP_CONCAT(id) FROM hx_organization_unload where FIND_IN_SET(pid,#{children, jdbcType=VARCHAR})
  </select>
  
  <delete id="delOrganizationById" parameterType="java.lang.String">
    delete from hx_organization where org_code = #{orgCode,jdbcType=VARCHAR}
  </delete>
  
  <delete id="delOrganizationUnload" parameterType="com.gome.gmhx.entity.HxOrganizationUnload">
    delete from hx_organization_unload
    where id = #{id,jdbcType=VARCHAR}
  </delete>
  
  <select id="queryAllOrganizationList" resultType="hashmap">
  	select v.id,v.name,v.pid,v.interface,v1.name as pname from v_organization v left join v_organization v1 on v.pid = v1.id
  </select>
  
  <insert id="addOrganizationUnload" parameterType="com.gome.gmhx.entity.HxOrganizationUnload" >
    insert into hx_organization_unload (id, name, pid,pname,interface)
    values (#{id,jdbcType=VARCHAR}, #{name,jdbcType=VARCHAR}, #{pid,jdbcType=VARCHAR}, #{pname,jdbcType=VARCHAR},
      #{interfaceDm,jdbcType=VARCHAR})
  </insert>
  
  <update id="updateOrganizationUnload" parameterType="com.gome.gmhx.entity.HxOrganizationUnload" >
    update hx_organization_unload 
    set name = #{name,jdbcType=VARCHAR},
    pid =  #{pid,jdbcType=VARCHAR}, 
    pname= #{pname,jdbcType=VARCHAR},
    interface =#{interfaceDm,jdbcType=VARCHAR}
    where id = #{id,jdbcType=VARCHAR}
  </update>
  
  <select id="getAllOrganizationList" resultType="hashmap">
  	select t.id,t.name,t.pid,t.interface,t.pname from hx_organization_unload t 
  </select>
  
  <select id="queryHxOrganizationList" resultType="hashmap">
  	 select t.org_code as id,t.org_name as name,t.org_parent_id as pid,'hx001' as interface,v1.name as pname
     from hx_organization t left join v_organization v1 on t.org_parent_id = v1.id where t. org_source = '0' 
  </select>
  
  <select id="getHxOrganizationList" resultType="hashmap">
  	select t.id,t.name,t.pid,t.interface,t.pname from hx_organization_unload t where t.interface ='hx001'
  </select>
  		
  <select id="getFittingStockTree" resultMap="BaseResultMap">
  	select t.dqgsdm as org_code,t.dqgsmc as org_name from hx_custom_sale_mapping t 
  </select>
 
  <select id="getFittingStockTreeData" resultMap="BaseResultMap" parameterType="com.gome.gmhx.entity.HxOrganization">
		select t.part_id from hx_fittingstock_part t
		where t.org_code = #{orgCode,jdbcType=VARCHAR}
  </select>
  
  <insert id="addFittingStockPart" parameterType="com.gome.gmhx.entity.HxOrganization" >
    insert into hx_fittingstock_part (org_code, part_id)
    values (#{orgCode,jdbcType=VARCHAR}, #{partId,jdbcType=VARCHAR})
  </insert>
  
  <delete id="deleteCompleteByOrgId" parameterType="com.gome.gmhx.entity.HxOrganization" >
    delete from hx_fittingstock_part where 1=1
      and org_code = #{orgCode,jdbcType=VARCHAR}
  </delete>
</mapper>